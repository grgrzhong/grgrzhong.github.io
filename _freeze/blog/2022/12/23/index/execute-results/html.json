{
  "hash": "beed567162c13d926118c8b0291ece19",
  "result": {
    "markdown": "---\ntitle: \"boxplot with p-value\"\ndate: 2022-12-23\ncategories:\n  - boxplot\n  - R\nimage: boxplot.png\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggsci)\nlibrary(ggprism)\nlibrary(rstatix)\nlibrary(ggpubr)\nlibrary(gapminder)\nlibrary(tidyverse)\n```\n:::\n\n\n## Fetch data\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf <- gapminder %>%\nfilter(year %in% c(1957, 2002, 2007), continent != \"Oceania\") %>% \nselect(country, year, lifeExp, continent) %>% \nmutate(paired = rep(1:(n()/3), each =3), year = factor(year)) \nhead(df)\n## # A tibble: 6 × 5\n##   country     year  lifeExp continent paired\n##   <fct>       <fct>   <dbl> <fct>      <int>\n## 1 Afghanistan 1957     30.3 Asia           1\n## 2 Afghanistan 2002     42.1 Asia           1\n## 3 Afghanistan 2007     43.8 Asia           1\n## 4 Albania     1957     59.3 Europe         2\n## 5 Albania     2002     75.7 Europe         2\n## 6 Albania     2007     76.4 Europe         2\n```\n:::\n\n## Statistic analysis\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf_pval <- df %>% \n  group_by(continent) %>%\n  wilcox_test(lifeExp ~ year) %>% \n  adjust_pvalue(p.col = \"p\", method = \"bonferroni\") %>% \n  add_significance(p.col = \"p.adj\") %>% \n  add_xy_position(x = \"year\", dodge = 0.8)\n```\n:::\n\n\n## Add p-value\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf %>% \n  ggplot(aes(x = year, y = lifeExp))+\n  stat_boxplot(aes(ymin = ..lower.., ymax = ..upper..), outlier.shape = NA, width = 0.5)+\n  stat_boxplot(geom = \"errorbar\", aes(ymin = ..ymax..), width = 0.2, size = 0.35)+\n  stat_boxplot(geom = \"errorbar\", aes(ymax = ..ymin..), width = 0.2, size = 0.35)+\n  geom_boxplot(aes(fill = year), color = \"black\", outlier.shape = NA, linetype = \"dashed\", width = 0.5, size = 0.3)+\n  stat_summary(geom = \"crossbar\", fun = \"median\", width = 0.5, color = \"black\", size = 0.38)+\n  scale_size_continuous(range = c(1, 3))+\n  facet_wrap(.~continent, nrow = 1)+\n  scale_fill_npg()+\n  scale_y_continuous(limits = c(0, 95), breaks = seq(0, 95, 15), guide = \"prism_offset_minor\")+\n  labs(x = NULL, y = NULL)+\n  theme(\n    plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), units = \"cm\"),\n    strip.text = element_text(size = 12),\n    axis.line = element_line(color = \"black\", size = 0.4),\n    panel.grid.major = element_line(size = 0.2, color = \"#e5e5e5\"),\n    panel.grid.minor = element_blank(),\n    panel.background = element_blank(),\n    panel.spacing = unit(0.1, \"lines\"),\n    axis.text.y = element_text(color = \"black\", size = 10),\n    axis.text.x = element_blank(),\n    axis.ticks.x = element_blank(),\n    legend.position = \"none\"\n  )+\n  coord_cartesian()+\n  ### add p-value\n  stat_pvalue_manual(\n    df_pval %>% filter(\n      continent %in% c(\"Asia\", \"Americas\"), group1 == \"1957\", group2 == \"2002\"\n      ),\n    label = \"p.adj.signif\", label.size = 5, hide.ns = F\n    )\n## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n## ℹ Please use `linewidth` instead.\n## Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.\n## ℹ Please use the `linewidth` argument instead.\n## Warning: The dot-dot notation (`..lower..`) was deprecated in ggplot2 3.4.0.\n## ℹ Please use `after_stat(lower)` instead.\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=85%}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}