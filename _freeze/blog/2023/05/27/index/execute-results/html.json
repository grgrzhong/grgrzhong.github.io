{
  "hash": "da76d247fa4bcee68fc0e1c806f6ca83",
  "result": {
    "markdown": "---\ntitle: \"Learning PCA, tSNE and UMAP from simple example\"\ndate: 2023-05-27\ndate-modified: last-modified\ncategories:\n  - r\n  - pca\n  - tsne\n  - umap\n  - unsupervised\n  - dimensional reduction\nimage: pca.png\ndescription: PCA, tSNE, and UMAP are the most commonly used l dimensionality reduction techniques visualizing high-dimensional datasets.\n---\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n### Load packages\npacman::p_load(\n    tidyverse,  # tidy data\n    FactoMineR, # compute principal component methods\n    factoextra,  # extract, visualize and interpretate the results\n    corrplot,  # visualize cos2 of variables\n    broom,\n    ggforce,\n    palmerpenguins,\n    umap,\n    Rtsne\n)\n```\n:::\n\n## Library and data\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n### load packages\nrm(list = ls())\n### demo data\npenguins <- penguins |> \n  drop_na() |> \n  select(-year)\nhead(penguins)\n## # A tibble: 6 × 7\n##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n##   <fct>   <fct>              <dbl>         <dbl>             <int>       <int>\n## 1 Adelie  Torgersen           39.1          18.7               181        3750\n## 2 Adelie  Torgersen           39.5          17.4               186        3800\n## 3 Adelie  Torgersen           40.3          18                 195        3250\n## 4 Adelie  Torgersen           36.7          19.3               193        3450\n## 5 Adelie  Torgersen           39.3          20.6               190        3650\n## 6 Adelie  Torgersen           38.9          17.8               181        3625\n## # ℹ 1 more variable: sex <fct>\n```\n:::\n\n\n## PCA\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n### Perform PCA using prcomp()\npca_fit <- penguins |> \n  select(where(is.numeric)) |> \n  scale() |> \n  prcomp()\n\n### importance of components\npca_fit\n## Standard deviations (1, .., p=4):\n## [1] 1.6569115 0.8821095 0.6071594 0.3284579\n## \n## Rotation (n x k) = (4 x 4):\n##                          PC1         PC2        PC3        PC4\n## bill_length_mm     0.4537532 -0.60019490 -0.6424951  0.1451695\n## bill_depth_mm     -0.3990472 -0.79616951  0.4258004 -0.1599044\n## flipper_length_mm  0.5768250 -0.00578817  0.2360952 -0.7819837\n## body_mass_g        0.5496747 -0.07646366  0.5917374  0.5846861\nsummary(pca_fit)\n## Importance of components:\n##                           PC1    PC2     PC3     PC4\n## Standard deviation     1.6569 0.8821 0.60716 0.32846\n## Proportion of Variance 0.6863 0.1945 0.09216 0.02697\n## Cumulative Proportion  0.6863 0.8809 0.97303 1.00000\n\n### visualize the PC1 and PC2\npca_fit |> \n  augment(penguins) |> \n  rename_at(\n    vars(starts_with(\".fitted\")), \n    list(~str_replace(., \".fitted\", \"\"))\n    ) |> \n    ggplot(aes(x = PC1, y = PC2, color = species, shape = sex)) +\n    geom_point()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n## UMAP\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrm(list = ls())\n### theme set\ntheme_set(theme_bw(18))\n### subset data\npenguins <- penguins |> \n  drop_na() |> \n  select(-year) |> \n  mutate(ID = row_number())\n\n### meta data\npenguins_meta <- penguins |> \n  select(ID, species, island, sex)\n### umap analysis\nset.seed(123)\numap_fit <- penguins |>\n  select(where(is.numeric)) |> \n  column_to_rownames(\"ID\") |> \n  scale() |> \n  umap()\n### retrieve data from umap analysis\numap_df <- umap_fit$layout |> \n  as.data.frame() |> \n  rename(UMAP1 = \"V1\", UMAP2 = \"V2\") |> \n  mutate(ID = row_number()) |> \n  inner_join(penguins_meta, by = \"ID\") |> \n  as_tibble()  \nhead(umap_df)\n## # A tibble: 6 × 6\n##   UMAP1 UMAP2    ID species island    sex   \n##   <dbl> <dbl> <int> <fct>   <fct>     <fct> \n## 1 -7.00 -1.14     1 Adelie  Torgersen male  \n## 2 -5.79 -1.28     2 Adelie  Torgersen female\n## 3 -5.39 -1.87     3 Adelie  Torgersen female\n## 4 -7.55 -2.53     4 Adelie  Torgersen female\n## 5 -8.77 -2.36     5 Adelie  Torgersen male  \n## 6 -6.22 -1.30     6 Adelie  Torgersen female\n### visualize umap\numap_df |> \n  ggplot(aes(x = UMAP1, y = UMAP2, color = species, shape = sex)) +\n  geom_point() +\n  labs(x = \"UMAP1\", y = \"UMAP2\", title = \"UMAP plot\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=672}\n:::\n\n```{.r .cell-code}\n\n### facet by island\numap_df |> \n  ggplot(aes(x = UMAP1, y = UMAP2, color = species))+\n  geom_point(size = 3, alpha = 0.5) +\n  facet_wrap(~island) +\n  labs(x = \"UMAP1\", y = \"UMAP2\", subtitle = \"UMAP plot\") +\n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-2.png){fig-align='center' width=672}\n:::\n\n```{.r .cell-code}\n\n### circlize the outlier cases\numap_df |> \n  ggplot(aes(x = UMAP1, y = UMAP2, color = species, shape = sex)) +\n  geom_point()+\n  labs(x = \"UMAP1\", y = \"UMAP2\", subtitle = \"UMAP plot\") +\n  geom_circle(aes(x0 = -5, y0= -3.8, r = 0.65), color = \"green\", inherit.aes = FALSE)\n## Warning in geom_circle(aes(x0 = -5, y0 = -3.8, r = 0.65), color = \"green\", : All aesthetics have length 1, but the data has 333 rows.\n## ℹ Did you mean to use `annotate()`?\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-3.png){fig-align='center' width=672}\n:::\n:::\n\n\n## tSNE\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrm(list = ls())\n### theme set\ntheme_set(theme_bw(18))\n### subset data\npenguins <- penguins |> \n  drop_na() |> \n  select(-year) |> \n  mutate(ID = row_number())\n\n### meta data\npenguins_meta <- penguins |> \n  select(ID, species, island, sex)\n\n### tSNE analysis\nset.seed(135)\ntsne_fit <- penguins |> \n  select(where(is.numeric)) |> \n  column_to_rownames(\"ID\") |> \n  scale() |> \n  Rtsne()\n\n### retrive data\ntsne_df  <- tsne_fit$Y |> \n  as.data.frame() |> \n  rename(tSNE1 = \"V1\", tSNE2 = \"V2\") |> \n  mutate(ID = row_number())\n\ntsne_df <- tsne_df |> \n  inner_join(penguins_meta, by = \"ID\")\n\n### check data\nhead(tsne_df)\n##        tSNE1     tSNE2 ID species    island    sex\n## 1  -5.788624  5.231530  1  Adelie Torgersen   male\n## 2  -6.308533  8.950800  2  Adelie Torgersen female\n## 3  -6.015678 12.082790  3  Adelie Torgersen female\n## 4  -9.649822  6.857170  4  Adelie Torgersen female\n## 5 -12.064101  4.828783  5  Adelie Torgersen   male\n## 6  -5.480114  7.486022  6  Adelie Torgersen female\n\n### visualize \ntsne_df |> \n  ggplot(\n    aes(x = tSNE1, y = tSNE2, color = species, shape = sex)) +\n  geom_point()+\n  theme(legend.position = \"right\") +\n  ### identify potential sample mismatch\n  geom_circle(\n    aes(x0 = 9, y0 = -2, r = 2),\n    color = \"green\",\n    inherit.aes = FALSE\n  )\n## Warning in geom_circle(aes(x0 = 9, y0 = -2, r = 2), color = \"green\", inherit.aes = FALSE): All aesthetics have length 1, but the data has 333 rows.\n## ℹ Did you mean to use `annotate()`?\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n## Reference\n\n - [How To Make PCA Plot with R](https://datavizpyr.com/how-to-make-pca-plot-with-r/) \n - [How To Make tSNE plot in R](https://datavizpyr.com/how-to-make-tsne-plot-in-r/)\n - [How to make UMAP plot in R](https://datavizpyr.com/how-to-make-umap-plot-in-r/)\n - [How To Annotate a Plot with Circle in R](https://datavizpyr.com/annotate-a-plot-with-circle-ggplot2/)\n \n ",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}