{
  "hash": "8d5af16e64c1d9449ab7ca005077dd84",
  "result": {
    "markdown": "---\ntitle: \"ggplot2 with p-value and significant level\"\ndate: 2023-03-06\ncategories:\n  - r\n  - p-value\n  - ggplot2\nimage: plot.png\n---\n\n\n\nA sample example to add p-value and significant level to barpot.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rstatix)\nlibrary(ggprism)\nlibrary(ggpubr)\nlibrary(ggsci)\n\n# package.list=c(\"tidyverse\",\"rstatix\",\"ggtext\")\n\n# for (package in package.list) {\n#   if (!require(package,character.only=T, quietly=T)) {\n#     install.packages(package)\n#     library(package, character.only=T)\n#   }\n# }\n```\n:::\n\n## Single group\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf <- ToothGrowth %>%\n    mutate(dose = as.factor(dose)) %>%\n    group_by(dose) %>%\n    summarise(value_mean = mean(len), sd = sd(len), se = sd(len) / sqrt(n()))\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nstat.test <- ToothGrowth %>%\n    t_test(data = ., len ~ dose, ref.group = \"0.5\") %>%\n    mutate(p.adj.signif = replace_na(p.adj.signif, \"\"), across(\"p.adj.signif\", str_replace, \"ns\", \"\")) %>%\n    select(group1, group2, p.adj, p.adj.signif) %>%\n    left_join(., df, by = c(\"group2\" = \"dose\")) %>%\n    mutate(y.position = value_mean + sd + 0.3)\n## Warning: There was 1 warning in `mutate()`.\n## ℹ In argument: `across(\"p.adj.signif\", str_replace, \"ns\", \"\")`.\n## Caused by warning:\n## ! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.\n## Supply arguments directly to `.fns` through an anonymous function instead.\n## \n##   # Previously\n##   across(a:b, mean, na.rm = TRUE)\n## \n##   # Now\n##   across(a:b, \\(x) mean(x, na.rm = TRUE))\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntheme_niwot <- function() {\n    theme_minimal() +\n        theme(\n            axis.title.x = element_blank(),\n            axis.line = element_line(color = \"#3D4852\"),\n            axis.ticks = element_line(color = \"#3D4852\"),\n            panel.grid.major.y = element_line(color = \"#DAE1E7\"),\n            panel.grid.major.x = element_blank(),\n            panel.background = element_rect(fill = \"white\"),\n            plot.background = element_rect(fill = \"white\"),\n            plot.margin = unit(rep(0.2, 4), \"cm\"),\n            axis.text = element_text(size = 12, color = \"#22292F\"),\n            axis.title = element_text(size = 12, hjust = 1),\n            axis.title.y = element_text(margin = margin(r = 12)),\n            axis.text.y = element_text(margin = margin(r = 5)),\n            axis.text.x = element_text(margin = margin(t = 5)),\n            legend.position = \"non\"\n        )\n}\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndf %>% ggplot(., aes(dose, value_mean)) +\n    geom_errorbar(aes(ymax = value_mean + sd, ymin = value_mean - sd), width = 0.1, color = \"grey30\") +\n    geom_col(width = 0.4, aes(fill = dose)) +\n    add_pvalue(stat.test,\n        label = \"p.adj.signif\", label.size = 6,\n        coord.flip = TRUE, remove.bracket = TRUE\n    ) +\n    scale_y_continuous(expand = c(0, 0), limits = c(0, 33)) +\n    theme_niwot() +\n    scale_fill_brewer(palette = \"Blues\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=85%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n df %>% ggplot(., aes(dose, value_mean)) +\n     geom_errorbar(aes(ymax = value_mean + sd, ymin = value_mean - sd), width = 0.1, color = \"grey30\") +\n     geom_col(width = 0.4, aes(fill = dose)) +\n     stat_pvalue_manual(stat.test %>% slice(1),\n         label = \"p.adj.signif\",\n         label.size = 6, tip.length = c(0.35, 0.003), linetype = 2\n     ) +\n     add_pvalue(stat.test %>% slice(2), label = \"p.adj.signif\", label.size = 6, tip.length = c(0.1, 0.003)) +\n     scale_y_continuous(expand = c(0, 0), limits = c(0, 33)) +\n     theme_niwot() +\n     scale_fill_brewer(palette = \"Blues\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=85%}\n:::\n\n```{.r .cell-code}\n # ggsave(\n #     here(\"blog\", \"2023\", \"03\", \"06\", \"plot.png\")\n # )\n```\n:::\n\n\n## Multiple group \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nstat.test <- iris %>%\n    pivot_longer(-Species) %>%\n    filter(Species != \"versicolor\") %>%\n    mutate(group = str_sub(name, start = 1, end = 5)) %>%\n    group_by(group, name) %>%\n    t_test(value ~ Species) %>%\n    adjust_pvalue() %>%\n    add_significance(\"p.adj\") %>%\n    add_xy_position(x = \"name\", scales = \"free\", fun = \"max\") %>%\n    select(-3, -6, -7, -8, -9, -10) %>%\n    mutate(\n        across(\"xmin\", str_replace, \"2.8\", \"0.8\"),\n        across(\"xmin\", str_replace, \"3.8\", \"1.8\"),\n        across(\"xmax\", str_replace, \"3.2\", \"1.2\"),\n        across(\"xmax\", str_replace, \"4.2\", \"2.2\")\n    ) %>%\n    mutate(xmin = as.numeric(xmin), xmax = as.numeric(xmax))\n\nstat.test\n## # A tibble: 4 × 11\n##   name   group group1 group2    p.adj p.adj.signif y.position groups     x  xmin\n##   <chr>  <chr> <chr>  <chr>     <dbl> <chr>             <dbl> <name> <dbl> <dbl>\n## 1 Petal… Petal setosa virgi… 3.71e-49 ****               7.5  <chr>      1   0.8\n## 2 Petal… Petal setosa virgi… 7.32e-48 ****               2.73 <chr>      2   1.8\n## 3 Sepal… Sepal setosa virgi… 7.94e-25 ****               8.15 <chr>      3   0.8\n## 4 Sepal… Sepal setosa virgi… 4.57e- 9 ****               4.47 <chr>      4   1.8\n## # ℹ 1 more variable: xmax <dbl>\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\niris %>%\n    pivot_longer(-Species) %>%\n    filter(Species != \"versicolor\") %>%\n    mutate(group = str_sub(name, start = 1, end = 5)) %>%\n    ggplot(., aes(x = name, y = value)) +\n    stat_summary(geom = \"bar\", position = \"dodge\", aes(fill = Species)) +\n    stat_summary(\n        geom = \"errorbar\", fun.data = \"mean_sdl\",\n        fun.args = list(mult = 1),\n        aes(fill = Species),\n        position = position_dodge(0.9), width = 0.2, color = \"black\"\n    ) +\n    stat_pvalue_manual(stat.test,\n        label = \"p.adj.signif\", label.size = 6, hide.ns = T,\n        tip.length = 0.01\n    ) +\n    facet_wrap(. ~ group, scale = \"free_x\", nrow = 1) +\n    labs(x = NULL, y = NULL) +\n    scale_fill_manual(values = c(\"#BA7A70\", \"#829BAB\")) +\n    scale_y_continuous(limits = c(0, 9), expand = c(0, 0)) +\n    theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_text(color = \"black\", size = 12, margin = margin(r = 3)),\n        axis.ticks.x = element_blank(),\n        axis.text.y = element_text(color = \"black\", size = 10, margin = margin(r = 2)),\n        axis.text.x = element_text(color = \"black\"),\n        panel.background = element_rect(fill = NA, color = NA),\n        panel.grid.minor = element_line(size = 0.2, color = \"#e5e5e5\"),\n        panel.grid.major = element_line(size = 0.2, color = \"#e5e5e5\"),\n        panel.border = element_rect(fill = NA, color = \"black\", size = 0.3, linetype = \"solid\"),\n        legend.key = element_blank(),\n        legend.title = element_blank(),\n        legend.text = element_text(color = \"black\", size = 8),\n        legend.spacing.x = unit(0.1, \"cm\"),\n        legend.key.width = unit(0.5, \"cm\"),\n        legend.key.height = unit(0.5, \"cm\"),\n        legend.position = c(1, 1), legend.justification = c(1, 1),\n        legend.background = element_blank(),\n        legend.box.margin = margin(0, 0, 0, 0),\n        strip.text = element_text(color = \"black\", size = 10),\n        panel.spacing.x = unit(0.3, \"cm\")\n    )\n## Warning in stat_summary(geom = \"errorbar\", fun.data = \"mean_sdl\", fun.args =\n## list(mult = 1), : Ignoring unknown aesthetics: fill\n## Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.\n## ℹ Please use the `linewidth` argument instead.\n## Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.\n## ℹ Please use the `linewidth` argument instead.\n## No summary function supplied, defaulting to `mean_se()`\n## No summary function supplied, defaulting to `mean_se()`\n## Warning: Computation failed in `stat_summary()`\n## Caused by error in `fun.data()`:\n## ! The package \"Hmisc\" is required.\n## Warning: Computation failed in `stat_summary()`\n## Caused by error in `fun.data()`:\n## ! The package \"Hmisc\" is required.\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=85%}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}