{
  "hash": "25c598f43e417465e09ca836842bab5f",
  "result": {
    "markdown": "---\ntitle: \"Customize UMAP using ggplot2 from Seruat output\"\ndate: 2023-11-21\ndate-modified: last-modified\ncategories:\n  - umap\nimage: umap.png\ndescription: Use ggplot2 to make nice coordinate, colors, and size for UMAP using embeddings from seruat object\n---\n\n\n\n\n## Load Seurat object\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n### Library packages\nlibrary(here)\nlibrary(tidyverse)\nlibrary(Seurat)\nlibrary(SingleR)\nlibrary(ggrepel)\n\n### Load data\nload(here(\"learn\", \"PBMC_tutorial\", \"pbmc_tutorial_singleR.RData\"))\n\n### Check data\npbmc\n## An object of class Seurat \n## 13714 features across 2638 samples within 1 assay \n## Active assay: RNA (13714 features, 2000 variable features)\n##  3 layers present: counts, data, scale.data\n##  3 dimensional reductions calculated: pca, umap, tsne\n\n### View the UMAP\nDimPlot(pbmc, group.by = c(\"seurat_clusters\", \"labels\"), reduction = \"umap\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=100%}\n:::\n:::\n\n## Retrieve UMAP data\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n### Find the UMAP data\nstr(pbmc)\n## Formal class 'Seurat' [package \"SeuratObject\"] with 13 slots\n##   ..@ assays      :List of 1\n##   .. ..$ RNA:Formal class 'Assay' [package \"SeuratObject\"] with 8 slots\n##   .. .. .. ..@ counts       :Formal class 'dgCMatrix' [package \"Matrix\"] with 6 slots\n##   .. .. .. .. .. ..@ i       : int [1:2238732] 29 73 80 148 163 184 186 227 229 230 ...\n##   .. .. .. .. .. ..@ p       : int [1:2639] 0 779 2131 3260 4220 4741 5522 6304 7094 7626 ...\n##   .. .. .. .. .. ..@ Dim     : int [1:2] 13714 2638\n##   .. .. .. .. .. ..@ Dimnames:List of 2\n##   .. .. .. .. .. .. ..$ : chr [1:13714] \"AL627309.1\" \"AP006222.2\" \"RP11-206L10.2\" \"RP11-206L10.9\" ...\n##   .. .. .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. .. .. ..@ x       : num [1:2238732] 1 1 2 1 1 1 1 41 1 1 ...\n##   .. .. .. .. .. ..@ factors : list()\n##   .. .. .. ..@ data         :Formal class 'dgCMatrix' [package \"Matrix\"] with 6 slots\n##   .. .. .. .. .. ..@ i       : int [1:2238732] 29 73 80 148 163 184 186 227 229 230 ...\n##   .. .. .. .. .. ..@ p       : int [1:2639] 0 779 2131 3260 4220 4741 5522 6304 7094 7626 ...\n##   .. .. .. .. .. ..@ Dim     : int [1:2] 13714 2638\n##   .. .. .. .. .. ..@ Dimnames:List of 2\n##   .. .. .. .. .. .. ..$ : chr [1:13714] \"AL627309.1\" \"AP006222.2\" \"RP11-206L10.2\" \"RP11-206L10.9\" ...\n##   .. .. .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. .. .. ..@ x       : num [1:2238732] 1.64 1.64 2.23 1.64 1.64 ...\n##   .. .. .. .. .. ..@ factors : list()\n##   .. .. .. ..@ scale.data   : num [1:2000, 1:2638] -0.8556 -0.2773 1.4947 -0.0463 -0.4658 ...\n##   .. .. .. .. ..- attr(*, \"dimnames\")=List of 2\n##   .. .. .. .. .. ..$ : chr [1:2000] \"ISG15\" \"CPSF3L\" \"MRPL20\" \"ATAD3C\" ...\n##   .. .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. ..@ assay.orig   : NULL\n##   .. .. .. ..@ var.features : chr [1:2000] \"PPBP\" \"LYZ\" \"S100A9\" \"IGLL5\" ...\n##   .. .. .. ..@ meta.features:'data.frame':\t13714 obs. of  5 variables:\n##   .. .. .. .. ..$ vst.mean                 : num [1:13714] 0.00341 0.00114 0.0019 0.00114 0.00682 ...\n##   .. .. .. .. ..$ vst.variance             : num [1:13714] 0.0034 0.00114 0.00189 0.00114 0.00678 ...\n##   .. .. .. .. ..$ vst.variance.expected    : num [1:13714] 0.00365 0.00114 0.00197 0.00114 0.00748 ...\n##   .. .. .. .. ..$ vst.variance.standardized: num [1:13714] 0.933 0.992 0.963 0.992 0.906 ...\n##   .. .. .. .. ..$ vst.variable             : logi [1:13714] FALSE FALSE FALSE FALSE FALSE FALSE ...\n##   .. .. .. ..@ misc         : list()\n##   .. .. .. ..@ key          : chr \"rna_\"\n##   ..@ meta.data   :'data.frame':\t2638 obs. of  8 variables:\n##   .. ..$ orig.ident     : Factor w/ 1 level \"pbmc3k\": 1 1 1 1 1 1 1 1 1 1 ...\n##   .. ..$ nCount_RNA     : num [1:2638] 2419 4903 3147 2639 980 ...\n##   .. ..$ nFeature_RNA   : int [1:2638] 779 1352 1129 960 521 781 782 790 532 550 ...\n##   .. ..$ percent.mt     : num [1:2638] 3.02 3.79 0.89 1.74 1.22 ...\n##   .. ..$ percent.HB     : num [1:2638] 0 0 0 0 0 0 0 0 0 0 ...\n##   .. ..$ RNA_snn_res.0.5: Factor w/ 9 levels \"0\",\"1\",\"2\",\"3\",..: 1 4 3 2 7 3 5 5 5 6 ...\n##   .. ..$ seurat_clusters: Factor w/ 9 levels \"0\",\"1\",\"2\",\"3\",..: 1 4 3 2 7 3 5 5 5 6 ...\n##   .. ..$ labels         : chr [1:2638] \"T_cells\" \"B_cell\" \"T_cells\" \"Monocyte\" ...\n##   ..@ active.assay: chr \"RNA\"\n##   ..@ active.ident: Factor w/ 9 levels \"0\",\"1\",\"2\",\"3\",..: 1 4 3 2 7 3 5 5 5 6 ...\n##   .. ..- attr(*, \"names\")= chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   ..@ graphs      :List of 2\n##   .. ..$ RNA_nn :Formal class 'Graph' [package \"SeuratObject\"] with 7 slots\n##   .. .. .. ..@ assay.used: chr \"RNA\"\n##   .. .. .. ..@ i         : int [1:52760] 0 6 102 203 213 229 292 451 547 618 ...\n##   .. .. .. ..@ p         : int [1:2639] 0 33 50 64 80 87 103 139 155 162 ...\n##   .. .. .. ..@ Dim       : int [1:2] 2638 2638\n##   .. .. .. ..@ Dimnames  :List of 2\n##   .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. ..@ x         : num [1:52760] 1 1 1 1 1 1 1 1 1 1 ...\n##   .. .. .. ..@ factors   : list()\n##   .. ..$ RNA_snn:Formal class 'Graph' [package \"SeuratObject\"] with 7 slots\n##   .. .. .. ..@ assay.used: chr \"RNA\"\n##   .. .. .. ..@ i         : int [1:194424] 0 6 102 136 187 203 229 292 421 446 ...\n##   .. .. .. ..@ p         : int [1:2639] 0 62 120 170 240 287 379 453 533 573 ...\n##   .. .. .. ..@ Dim       : int [1:2] 2638 2638\n##   .. .. .. ..@ Dimnames  :List of 2\n##   .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. ..@ x         : num [1:194424] 1 0.1111 0.1765 0.0811 0.0811 ...\n##   .. .. .. ..@ factors   : list()\n##   ..@ neighbors   : list()\n##   ..@ reductions  :List of 3\n##   .. ..$ pca :Formal class 'DimReduc' [package \"SeuratObject\"] with 9 slots\n##   .. .. .. ..@ cell.embeddings           : num [1:2638, 1:50] -5.84 -2.56 -1.64 13.29 -2.15 ...\n##   .. .. .. .. ..- attr(*, \"dimnames\")=List of 2\n##   .. .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. .. .. ..$ : chr [1:50] \"PC_1\" \"PC_2\" \"PC_3\" \"PC_4\" ...\n##   .. .. .. ..@ feature.loadings          : num [1:2000, 1:50] 0.01091 0.11663 0.11569 -0.00853 -0.01632 ...\n##   .. .. .. .. ..- attr(*, \"dimnames\")=List of 2\n##   .. .. .. .. .. ..$ : chr [1:2000] \"PPBP\" \"LYZ\" \"S100A9\" \"IGLL5\" ...\n##   .. .. .. .. .. ..$ : chr [1:50] \"PC_1\" \"PC_2\" \"PC_3\" \"PC_4\" ...\n##   .. .. .. ..@ feature.loadings.projected: num[0 , 0 ] \n##   .. .. .. ..@ assay.used                : chr \"RNA\"\n##   .. .. .. ..@ global                    : logi FALSE\n##   .. .. .. ..@ stdev                     : num [1:50] 7.05 4.5 3.87 3.75 3.15 ...\n##   .. .. .. ..@ jackstraw                 :Formal class 'JackStrawData' [package \"SeuratObject\"] with 4 slots\n##   .. .. .. .. .. ..@ empirical.p.values     : num [1:2000, 1:20] 0.0005 0 0 0.0035 0 0 0.01 0 0.0135 0 ...\n##   .. .. .. .. .. .. ..- attr(*, \"dimnames\")=List of 2\n##   .. .. .. .. .. .. .. ..$ : chr [1:2000] \"PPBP\" \"LYZ\" \"S100A9\" \"IGLL5\" ...\n##   .. .. .. .. .. .. .. ..$ : chr [1:20] \"PC1\" \"PC2\" \"PC3\" \"PC4\" ...\n##   .. .. .. .. .. ..@ fake.reduction.scores  : num [1:2000, 1:20] -0.003524 0.000285 -0.000627 0.002054 0.000959 ...\n##   .. .. .. .. .. ..@ empirical.p.values.full: logi [1, 1] NA\n##   .. .. .. .. .. ..@ overall.p.values       : num [1:20, 1:2] 1 2 3 4 5 6 7 8 9 10 ...\n##   .. .. .. .. .. .. ..- attr(*, \"dimnames\")=List of 2\n##   .. .. .. .. .. .. .. ..$ : NULL\n##   .. .. .. .. .. .. .. ..$ : chr [1:2] \"PC\" \"Score\"\n##   .. .. .. ..@ misc                      :List of 1\n##   .. .. .. .. ..$ total.variance: num 1734\n##   .. .. .. ..@ key                       : chr \"PC_\"\n##   .. ..$ umap:Formal class 'DimReduc' [package \"SeuratObject\"] with 9 slots\n##   .. .. .. ..@ cell.embeddings           : num [1:2638, 1:2] -4.58 -2.81 -1.68 12.69 -9.83 ...\n##   .. .. .. .. ..- attr(*, \"scaled:center\")= num [1:2] -0.0395 -1.1523\n##   .. .. .. .. ..- attr(*, \"dimnames\")=List of 2\n##   .. .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. .. .. ..$ : chr [1:2] \"UMAP_1\" \"UMAP_2\"\n##   .. .. .. ..@ feature.loadings          : num[0 , 0 ] \n##   .. .. .. ..@ feature.loadings.projected: num[0 , 0 ] \n##   .. .. .. ..@ assay.used                : chr \"RNA\"\n##   .. .. .. ..@ global                    : logi TRUE\n##   .. .. .. ..@ stdev                     : num(0) \n##   .. .. .. ..@ jackstraw                 :Formal class 'JackStrawData' [package \"SeuratObject\"] with 4 slots\n##   .. .. .. .. .. ..@ empirical.p.values     : num[0 , 0 ] \n##   .. .. .. .. .. ..@ fake.reduction.scores  : num[0 , 0 ] \n##   .. .. .. .. .. ..@ empirical.p.values.full: num[0 , 0 ] \n##   .. .. .. .. .. ..@ overall.p.values       : num[0 , 0 ] \n##   .. .. .. ..@ misc                      : list()\n##   .. .. .. ..@ key                       : chr \"UMAP_\"\n##   .. ..$ tsne:Formal class 'DimReduc' [package \"SeuratObject\"] with 9 slots\n##   .. .. .. ..@ cell.embeddings           : num [1:2638, 1:2] -11.1 -36.27 1.96 37.46 -20.88 ...\n##   .. .. .. .. ..- attr(*, \"dimnames\")=List of 2\n##   .. .. .. .. .. ..$ : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. .. .. ..$ : chr [1:2] \"tSNE_1\" \"tSNE_2\"\n##   .. .. .. ..@ feature.loadings          : num[0 , 0 ] \n##   .. .. .. ..@ feature.loadings.projected: num[0 , 0 ] \n##   .. .. .. ..@ assay.used                : chr \"RNA\"\n##   .. .. .. ..@ global                    : logi TRUE\n##   .. .. .. ..@ stdev                     : num(0) \n##   .. .. .. ..@ jackstraw                 :Formal class 'JackStrawData' [package \"SeuratObject\"] with 4 slots\n##   .. .. .. .. .. ..@ empirical.p.values     : num[0 , 0 ] \n##   .. .. .. .. .. ..@ fake.reduction.scores  : num[0 , 0 ] \n##   .. .. .. .. .. ..@ empirical.p.values.full: num[0 , 0 ] \n##   .. .. .. .. .. ..@ overall.p.values       : num[0 , 0 ] \n##   .. .. .. ..@ misc                      : list()\n##   .. .. .. ..@ key                       : chr \"tSNE_\"\n##   ..@ images      : list()\n##   ..@ project.name: chr \"pbmc3k\"\n##   ..@ misc        : list()\n##   ..@ version     :Classes 'package_version', 'numeric_version'  hidden list of 1\n##   .. ..$ : int [1:3] 4 0 0\n##   ..@ commands    :List of 10\n##   .. ..$ NormalizeData.RNA       :Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"NormalizeData.RNA\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:49:17\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr [1:2] \"NormalizeData(pbmc, normalization.method = \\\"LogNormalize\\\", \" \"    scale.factor = 10000)\"\n##   .. .. .. ..@ params     :List of 5\n##   .. .. .. .. ..$ assay               : chr \"RNA\"\n##   .. .. .. .. ..$ normalization.method: chr \"LogNormalize\"\n##   .. .. .. .. ..$ scale.factor        : num 10000\n##   .. .. .. .. ..$ margin              : num 1\n##   .. .. .. .. ..$ verbose             : logi TRUE\n##   .. ..$ FindVariableFeatures.RNA:Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"FindVariableFeatures.RNA\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:49:18\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr \"FindVariableFeatures(pbmc, selection.method = \\\"vst\\\", nfeatures = 2000)\"\n##   .. .. .. ..@ params     :List of 12\n##   .. .. .. .. ..$ assay              : chr \"RNA\"\n##   .. .. .. .. ..$ selection.method   : chr \"vst\"\n##   .. .. .. .. ..$ loess.span         : num 0.3\n##   .. .. .. .. ..$ clip.max           : chr \"auto\"\n##   .. .. .. .. ..$ mean.function      :function (mat, display_progress)  \n##   .. .. .. .. ..$ dispersion.function:function (mat, display_progress)  \n##   .. .. .. .. ..$ num.bin            : num 20\n##   .. .. .. .. ..$ binning.method     : chr \"equal_width\"\n##   .. .. .. .. ..$ nfeatures          : num 2000\n##   .. .. .. .. ..$ mean.cutoff        : num [1:2] 0.1 8\n##   .. .. .. .. ..$ dispersion.cutoff  : num [1:2] 1 Inf\n##   .. .. .. .. ..$ verbose            : logi TRUE\n##   .. ..$ ScaleData.RNA           :Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"ScaleData.RNA\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:49:47\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr \"ScaleData(pbmc, vars.to.regress = \\\"percent.mt\\\")\"\n##   .. .. .. ..@ params     :List of 11\n##   .. .. .. .. ..$ features          : chr [1:2000] \"PPBP\" \"LYZ\" \"S100A9\" \"IGLL5\" ...\n##   .. .. .. .. ..$ assay             : chr \"RNA\"\n##   .. .. .. .. ..$ vars.to.regress   : chr \"percent.mt\"\n##   .. .. .. .. ..$ model.use         : chr \"linear\"\n##   .. .. .. .. ..$ use.umi           : logi FALSE\n##   .. .. .. .. ..$ do.scale          : logi TRUE\n##   .. .. .. .. ..$ do.center         : logi TRUE\n##   .. .. .. .. ..$ scale.max         : num 10\n##   .. .. .. .. ..$ block.size        : num 1000\n##   .. .. .. .. ..$ min.cells.to.block: num 2638\n##   .. .. .. .. ..$ verbose           : logi TRUE\n##   .. ..$ RunPCA.RNA              :Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"RunPCA.RNA\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:49:54\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr \"RunPCA(pbmc, features = VariableFeatures(object = pbmc))\"\n##   .. .. .. ..@ params     :List of 11\n##   .. .. .. .. ..$ assay          : chr \"RNA\"\n##   .. .. .. .. ..$ features       : chr [1:2000] \"PPBP\" \"LYZ\" \"S100A9\" \"IGLL5\" ...\n##   .. .. .. .. ..$ npcs           : num 50\n##   .. .. .. .. ..$ rev.pca        : logi FALSE\n##   .. .. .. .. ..$ weight.by.var  : logi TRUE\n##   .. .. .. .. ..$ verbose        : logi TRUE\n##   .. .. .. .. ..$ ndims.print    : int [1:5] 1 2 3 4 5\n##   .. .. .. .. ..$ nfeatures.print: num 30\n##   .. .. .. .. ..$ reduction.name : chr \"pca\"\n##   .. .. .. .. ..$ reduction.key  : chr \"PC_\"\n##   .. .. .. .. ..$ seed.use       : num 42\n##   .. ..$ JackStraw.RNA.pca       :Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"JackStraw.RNA.pca\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:54:13\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr \"JackStraw(pbmc, num.replicate = 100)\"\n##   .. .. .. ..@ params     :List of 7\n##   .. .. .. .. ..$ reduction    : chr \"pca\"\n##   .. .. .. .. ..$ assay        : chr \"RNA\"\n##   .. .. .. .. ..$ dims         : num 20\n##   .. .. .. .. ..$ num.replicate: num 100\n##   .. .. .. .. ..$ prop.freq    : num 0.01\n##   .. .. .. .. ..$ verbose      : logi TRUE\n##   .. .. .. .. ..$ maxit        : num 1000\n##   .. ..$ ScoreJackStraw          :Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"ScoreJackStraw\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:54:13\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr \"ScoreJackStraw(pbmc, dims = 1:20)\"\n##   .. .. .. ..@ params     :List of 4\n##   .. .. .. .. ..$ reduction   : chr \"pca\"\n##   .. .. .. .. ..$ dims        : int [1:20] 1 2 3 4 5 6 7 8 9 10 ...\n##   .. .. .. .. ..$ score.thresh: num 1e-05\n##   .. .. .. .. ..$ do.plot     : logi FALSE\n##   .. ..$ FindNeighbors.RNA.pca   :Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"FindNeighbors.RNA.pca\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:54:15\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr \"FindNeighbors(pbmc, dims = 1:10)\"\n##   .. .. .. ..@ params     :List of 17\n##   .. .. .. .. ..$ reduction      : chr \"pca\"\n##   .. .. .. .. ..$ dims           : int [1:10] 1 2 3 4 5 6 7 8 9 10\n##   .. .. .. .. ..$ assay          : chr \"RNA\"\n##   .. .. .. .. ..$ k.param        : num 20\n##   .. .. .. .. ..$ return.neighbor: logi FALSE\n##   .. .. .. .. ..$ compute.SNN    : logi TRUE\n##   .. .. .. .. ..$ prune.SNN      : num 0.0667\n##   .. .. .. .. ..$ nn.method      : chr \"annoy\"\n##   .. .. .. .. ..$ n.trees        : num 50\n##   .. .. .. .. ..$ annoy.metric   : chr \"euclidean\"\n##   .. .. .. .. ..$ nn.eps         : num 0\n##   .. .. .. .. ..$ verbose        : logi TRUE\n##   .. .. .. .. ..$ force.recalc   : logi FALSE\n##   .. .. .. .. ..$ do.plot        : logi FALSE\n##   .. .. .. .. ..$ graph.name     : chr [1:2] \"RNA_nn\" \"RNA_snn\"\n##   .. .. .. .. ..$ l2.norm        : logi FALSE\n##   .. .. .. .. ..$ cache.index    : logi FALSE\n##   .. ..$ FindClusters            :Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"FindClusters\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:54:15\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr \"FindClusters(pbmc, resolution = 0.5)\"\n##   .. .. .. ..@ params     :List of 10\n##   .. .. .. .. ..$ graph.name      : chr \"RNA_snn\"\n##   .. .. .. .. ..$ modularity.fxn  : num 1\n##   .. .. .. .. ..$ resolution      : num 0.5\n##   .. .. .. .. ..$ method          : chr \"matrix\"\n##   .. .. .. .. ..$ algorithm       : num 1\n##   .. .. .. .. ..$ n.start         : num 10\n##   .. .. .. .. ..$ n.iter          : num 10\n##   .. .. .. .. ..$ random.seed     : num 0\n##   .. .. .. .. ..$ group.singletons: logi TRUE\n##   .. .. .. .. ..$ verbose         : logi TRUE\n##   .. ..$ RunUMAP.RNA.pca         :Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"RunUMAP.RNA.pca\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:54:28\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr \"RunUMAP(pbmc, dims = 1:10)\"\n##   .. .. .. ..@ params     :List of 22\n##   .. .. .. .. ..$ dims                : int [1:10] 1 2 3 4 5 6 7 8 9 10\n##   .. .. .. .. ..$ reduction           : chr \"pca\"\n##   .. .. .. .. ..$ assay               : chr \"RNA\"\n##   .. .. .. .. ..$ slot                : chr \"data\"\n##   .. .. .. .. ..$ umap.method         : chr \"uwot\"\n##   .. .. .. .. ..$ return.model        : logi FALSE\n##   .. .. .. .. ..$ n.neighbors         : int 30\n##   .. .. .. .. ..$ n.components        : int 2\n##   .. .. .. .. ..$ metric              : chr \"cosine\"\n##   .. .. .. .. ..$ learning.rate       : num 1\n##   .. .. .. .. ..$ min.dist            : num 0.3\n##   .. .. .. .. ..$ spread              : num 1\n##   .. .. .. .. ..$ set.op.mix.ratio    : num 1\n##   .. .. .. .. ..$ local.connectivity  : int 1\n##   .. .. .. .. ..$ repulsion.strength  : num 1\n##   .. .. .. .. ..$ negative.sample.rate: int 5\n##   .. .. .. .. ..$ uwot.sgd            : logi FALSE\n##   .. .. .. .. ..$ seed.use            : int 42\n##   .. .. .. .. ..$ angular.rp.forest   : logi FALSE\n##   .. .. .. .. ..$ verbose             : logi TRUE\n##   .. .. .. .. ..$ reduction.name      : chr \"umap\"\n##   .. .. .. .. ..$ reduction.key       : chr \"UMAP_\"\n##   .. ..$ RunTSNE                 :Formal class 'SeuratCommand' [package \"SeuratObject\"] with 5 slots\n##   .. .. .. ..@ name       : chr \"RunTSNE\"\n##   .. .. .. ..@ time.stamp : POSIXct[1:1], format: \"2021-07-08 11:54:36\"\n##   .. .. .. ..@ assay.used : chr \"RNA\"\n##   .. .. .. ..@ call.string: chr \"RunTSNE(pbmc, dims = 1:10)\"\n##   .. .. .. ..@ params     :List of 8\n##   .. .. .. .. ..$ reduction     : chr \"pca\"\n##   .. .. .. .. ..$ cells         : chr [1:2638] \"AAACATACAACCAC-1\" \"AAACATTGAGCTAC-1\" \"AAACATTGATCAGC-1\" \"AAACCGTGCTTCCG-1\" ...\n##   .. .. .. .. ..$ dims          : int [1:10] 1 2 3 4 5 6 7 8 9 10\n##   .. .. .. .. ..$ seed.use      : num 1\n##   .. .. .. .. ..$ tsne.method   : chr \"Rtsne\"\n##   .. .. .. .. ..$ dim.embed     : num 2\n##   .. .. .. .. ..$ reduction.name: chr \"tsne\"\n##   .. .. .. .. ..$ reduction.key : chr \"tSNE_\"\n##   ..@ tools       :List of 2\n##   .. ..$ BuildClusterTree           :List of 4\n##   .. .. ..$ edge       : int [1:16, 1:2] 10 10 11 12 12 11 13 14 14 16 ...\n##   .. .. ..$ edge.length: num [1:16] 463 158 174 131 131 ...\n##   .. .. ..$ tip.label  : chr [1:9] \"0\" \"1\" \"2\" \"3\" ...\n##   .. .. ..$ Nnode      : int 8\n##   .. .. ..- attr(*, \"class\")= chr \"phylo\"\n##   .. .. ..- attr(*, \"order\")= chr \"cladewise\"\n##   .. ..$ CalculateBarcodeInflections:List of 4\n##   .. .. ..$ barcode_distribution:'data.frame':\t2638 obs. of  4 variables:\n##   .. .. .. ..$ orig.ident: Factor w/ 1 level \"pbmc3k\": 1 1 1 1 1 1 1 1 1 1 ...\n##   .. .. .. ..$ nCount_RNA: num [1:2638] 8875 8415 8011 7928 7167 ...\n##   .. .. .. ..$ rank      : num [1:2638] 1 2 3 4 5 6 7 8 9 10 ...\n##   .. .. .. ..$ rawdiff   : num [1:2638] 0 -0.02311 -0.02136 -0.00452 -0.04382 ...\n##   .. .. ..$ inflection_points   :'data.frame':\t1 obs. of  3 variables:\n##   .. .. .. ..$ orig.ident: Factor w/ 1 level \"pbmc3k\": 1\n##   .. .. .. ..$ nCount_RNA: num 7167\n##   .. .. .. ..$ rank      : num 5\n##   .. .. ..$ threshold_values    :'data.frame':\t2 obs. of  2 variables:\n##   .. .. .. ..$ threshold: chr [1:2] \"threshold.low\" \"threshold.high\"\n##   .. .. .. ..$ rank     : num [1:2] 1 2638\n##   .. .. ..$ cells_pass          : chr [1:2635] \"GGGCCAACCTTGGA-1\" \"CAGGTTGAGGATCT-1\" \"ACGAGGGACAGGAG-1\" \"AAGCCATGAACTGC-1\" ...\n\n### Retrieve the coordinates of each cell, and cluster, celltype information\numap <- pbmc@reductions$umap@cell.embeddings %>% \n  as.data.frame() %>% \n  cbind(cell_type = pbmc@meta.data$labels)\n\nhead(umap)\n##                     UMAP_1     UMAP_2 cell_type\n## AAACATACAACCAC-1 -4.577857   1.650203   T_cells\n## AAACATTGAGCTAC-1 -2.813911 -11.897462    B_cell\n## AAACATTGATCAGC-1 -1.684490   3.302480   T_cells\n## AAACCGTGCTTCCG-1 12.694498   2.098798  Monocyte\n## AAACCGTGTATGCG-1 -9.829201   3.982013   NK_cell\n## AAACGCACTGGTAC-1 -2.908319   1.249230   T_cells\n```\n:::\n\n## Make UMAP with ggplot2\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n### Define the colors\nallcolour <- c(\n    \"#DC143C\",\"#0000FF\",\"#20B2AA\",\"#FFA500\",\"#9370DB\",\"#98FB98\",\"#F08080\",\n    \"#1E90FF\",\"#7CFC00\",\"#FFFF00\", \"#808000\",\"#FF00FF\",\"#FA8072\",\"#7B68EE\",\n    \"#9400D3\",\"#800080\",\"#A0522D\",\"#D2B48C\",\"#D2691E\",\"#87CEEB\",\"#40E0D0\",\n    \"#5F9EA0\",\"#FF1493\",\"#0000CD\",\"#008B8B\",\"#FFE4B5\",\"#8A2BE2\",\"#228B22\",\n    \"#E9967A\",\"#4682B4\",\"#32CD32\",\"#F0E68C\",\"#FFFFE0\",\"#EE82EE\",\"#FF6347\",\n    \"#6A5ACD\",\"#9932CC\",\"#8B008B\",\"#8B4513\",\"#DEB887\"\n)\n\n### ggplot2\np <- ggplot(umap, aes(x = UMAP_1, y = UMAP_2, color = cell_type)) +\n    geom_point(size = 1, alpha = 1) +\n    ### MAP cluster with color\n    scale_color_manual(values = allcolour) +\n    ### Axis annotation\n    geom_segment(\n        aes(\n            x = min(umap$UMAP_1) , y = min(umap$UMAP_2) ,\n            xend = min(umap$UMAP_1) +3, yend = min(umap$UMAP_2)\n        ), colour = \"black\", linewidth = 1,arrow = arrow(length = unit(0.3,\"cm\"))\n    ) + \n    geom_segment(\n        aes(\n            x = min(umap$UMAP_1)  , y = min(umap$UMAP_2)  ,\n            xend = min(umap$UMAP_1) , yend = min(umap$UMAP_2) + 3),\n            colour = \"black\", linewidth = 1,arrow = arrow(length = unit(0.3,\"cm\"))\n    ) +\n    annotate(\n        \"text\", x = min(umap$UMAP_1) +1.5, y = min(umap$UMAP_2) -1, \n        label = \"UMAP_1\", color=\"black\",size = 3, fontface=\"bold\"\n    ) + \n    annotate(\n        \"text\", x = min(umap$UMAP_1) -1, y = min(umap$UMAP_2) + 1.5, \n        label = \"UMAP_2\", color=\"black\",size = 3, fontface=\"bold\" ,angle=90\n    ) + \n    theme(\n        panel.grid.major = element_blank(),\n        panel.grid.minor = element_blank(),\n        panel.border = element_blank(),\n        axis.title = element_blank(),\n        axis.text = element_blank(),\n        axis.ticks = element_blank(),\n        panel.background = element_rect(fill = \"white\"),\n        plot.background = element_rect(fill = \"white\"),\n        legend.title = element_blank(), \n        legend.key=element_rect(fill= \"white\"),\n        legend.text = element_text(size = 20),\n        legend.key.size=unit(1, \"cm\")\n    ) +\n    ### legend label size\n    guides(color = guide_legend(override.aes = list(size=5)))\n### View it\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Annotate cell type on UMAP\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n### Calcualte the median coordinates of each cluster\ncell_type_med <- umap %>%\n  group_by(cell_type) %>%\n  summarise(UMAP_1 = median(UMAP_1),\n    UMAP_2 = median(UMAP_2)\n  )\n### Annotation\np + geom_label_repel(\n    aes(label = cell_type, size = 20), fontface = \"bold\", data = cell_type_med,\n    point.padding = unit(0.5, \"lines\")\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=100%}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}